{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "quicksite-ai-spec-schema",
  "title": "QuickSite AI Spec",
  "description": "Schema for AI specification files used in QuickSite admin panel",
  "type": "object",
  "required": ["id", "version", "meta", "dataRequirements", "relatedCommands"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$",
      "description": "Unique identifier for the spec (kebab-case)"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of this spec"
    },
    "meta": {
      "type": "object",
      "required": ["icon", "titleKey", "descriptionKey", "category"],
      "properties": {
        "icon": {
          "type": "string",
          "description": "Emoji icon for display"
        },
        "titleKey": {
          "type": "string",
          "description": "Translation key for the spec title"
        },
        "descriptionKey": {
          "type": "string",
          "description": "Translation key for the spec description"
        },
        "category": {
          "type": "string",
          "enum": ["creation", "modification", "content", "style", "advanced", "wip"],
          "description": "Category for organizing specs"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Tags for filtering and search"
        },
        "difficulty": {
          "type": "string",
          "enum": ["beginner", "intermediate", "advanced"],
          "description": "Complexity level for user guidance"
        }
      }
    },
    "parameters": {
      "type": "array",
      "description": "User-configurable parameters shown in the UI",
      "items": {
        "type": "object",
        "required": ["id", "type", "labelKey"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Parameter identifier"
          },
          "type": {
            "type": "string",
            "enum": ["text", "textarea", "select", "multiselect", "checkbox", "number", "nodeSelector"],
            "description": "Input type for the parameter"
          },
          "labelKey": {
            "type": "string",
            "description": "Translation key for the label"
          },
          "placeholderKey": {
            "type": "string",
            "description": "Translation key for placeholder text"
          },
          "helpKey": {
            "type": "string",
            "description": "Translation key for help text"
          },
          "required": {
            "type": "boolean",
            "default": false
          },
          "default": {
            "description": "Default value for the parameter"
          },
          "options": {
            "oneOf": [
              {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": ["value", "labelKey"],
                  "properties": {
                    "value": { "type": "string" },
                    "labelKey": { "type": "string" }
                  }
                }
              },
              {
                "type": "string",
                "pattern": "^dynamic:",
                "description": "Dynamic options from a command, e.g., 'dynamic:getLangList.data.languages'"
              }
            ]
          },
          "validation": {
            "type": "object",
            "properties": {
              "minLength": { "type": "integer" },
              "maxLength": { "type": "integer" },
              "pattern": { "type": "string" },
              "min": { "type": "number" },
              "max": { "type": "number" }
            }
          },
          "condition": {
            "type": "string",
            "description": "Conditional expression to show/hide this parameter. Supports: paramId === value, paramId !== value, paramId (truthy). Example: 'multilingual === true'"
          },
          "structures": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["page", "menu", "footer", "component"]
            },
            "description": "For nodeSelector type: which structure types to show for node selection"
          },
          "allowTextHint": {
            "type": "boolean",
            "description": "For nodeSelector type: allow user to type a text hint instead of selecting a node"
          },
          "optional": {
            "type": "boolean",
            "description": "Whether this parameter can be left empty"
          }
        }
      }
    },
    "examples": {
      "type": "array",
      "description": "Pre-defined example prompts",
      "items": {
        "type": "object",
        "required": ["id", "titleKey", "promptKey"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Example identifier"
          },
          "titleKey": {
            "type": "string",
            "description": "Translation key for example title"
          },
          "promptKey": {
            "type": "string",
            "description": "Translation key for the example prompt text"
          },
          "params": {
            "type": "object",
            "description": "Pre-filled parameter values for this example"
          }
        }
      }
    },
    "dataRequirements": {
      "type": "array",
      "description": "List of data needed from the system via CommandRunner",
      "items": {
        "type": "object",
        "required": ["id", "command"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Identifier used in prompt template"
          },
          "command": {
            "type": "string",
            "description": "Command name from CommandRunner whitelist"
          },
          "params": {
            "type": "object",
            "description": "Parameters to pass to the command"
          },
          "urlParams": {
            "type": "array",
            "items": { "type": "string" },
            "description": "URL parameters for the command"
          },
          "extract": {
            "type": "string",
            "description": "Dot-notation path to extract specific data (e.g., 'data.languages')"
          },
          "condition": {
            "type": "string",
            "description": "Parameter ID or expression. Data is only fetched when this evaluates to truthy. Example: 'targetPage' or 'multilingual === true'"
          }
        }
      }
    },
    "relatedCommands": {
      "type": "array",
      "items": { "type": "string" },
      "description": "API commands that will be used in the generated output"
    },
    "recommendedModels": {
      "type": "object",
      "description": "Recommended AI models per provider for this spec",
      "additionalProperties": {
        "type": "array",
        "items": { "type": "string" },
        "description": "List of recommended model IDs for a provider"
      },
      "examples": [
        {
          "openai": ["gpt-4o", "gpt-4-turbo"],
          "anthropic": ["claude-sonnet-4-20250514", "claude-3-5-sonnet-20241022"],
          "google": ["gemini-1.5-pro", "gemini-2.0-flash"]
        }
      ]
    },
    "providerNotes": {
      "type": "object",
      "description": "Provider-specific notes or warnings for this spec",
      "additionalProperties": {
        "type": "string",
        "description": "Note text for a specific provider"
      },
      "examples": [
        {
          "openai": "Works best with GPT-4o for complex website creation",
          "anthropic": "Claude models excel at following structured JSON output format"
        }
      ]
    },
    "promptTemplate": {
      "type": "string",
      "description": "Filename of the .md prompt template (same folder as spec)"
    },
    "outputFormat": {
      "type": "string",
      "enum": ["json-commands", "json-structure", "text"],
      "default": "json-commands",
      "description": "Expected output format from AI"
    },
    "preCommands": {
      "type": "array",
      "description": "Commands to execute BEFORE the AI-generated output (e.g., fresh start)",
      "items": {
        "$ref": "#/definitions/specCommand"
      }
    },
    "postCommands": {
      "type": "array",
      "description": "Commands to execute AFTER the AI-generated output (e.g., lang-switch component)",
      "items": {
        "$ref": "#/definitions/specCommand"
      }
    }
  },
  "definitions": {
    "specCommand": {
      "type": "object",
      "description": "A command or template to execute automatically",
      "properties": {
        "condition": {
          "type": "string",
          "description": "Condition expression. Supports: param.X === value, config.MULTILINGUAL_SUPPORT === true"
        },
        "template": {
          "type": "string",
          "description": "Name of a batch template to execute (mutually exclusive with command)"
        },
        "command": {
          "type": "string",
          "description": "API command name to execute (mutually exclusive with template)"
        },
        "params": {
          "type": "object",
          "description": "Parameters for the command. Supports {{config.X}} and $each loops",
          "additionalProperties": true
        }
      },
      "oneOf": [
        { "required": ["template"] },
        { "required": ["command", "params"] }
      ]
    },
    "eachLoop": {
      "type": "object",
      "description": "Loop construct for generating arrays from config data",
      "properties": {
        "$each": {
          "type": "string",
          "description": "Source to iterate over, e.g., {{config.LANGUAGES_NAME}}"
        },
        "$item": {
          "type": "object",
          "description": "Template for each item. Use {{$key}} and {{$value}} for placeholders"
        }
      },
      "required": ["$each", "$item"]
    }
  }
}
